I"‚4<hr />

<p>æ¥ä¸Šç¯‡ï¼š<a href="/myblogs/å®¢æˆ·ç«¯(å¤šçº¿ç¨‹-é¢å‘å¯¹è±¡)">å®¢æˆ·ç«¯(å¤šçº¿ç¨‹ï¼Œé¢å‘å¯¹è±¡)</a>å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ã€‚å®¢æˆ·ç«¯è´Ÿè´£æ”¶é›†ç”¨æˆ·çš„æ³¨å†Œä¿¡æ¯ï¼ŒæœåŠ¡ç«¯è´Ÿè´£å­˜å‚¨åˆæ³•çš„ç”¨æˆ·æ³¨å†Œä¿¡æ¯ï¼›ç”¨æˆ·å¯åŠ¨å®¢æˆ·åº¦æ—¶è·å¾—æ“ä½œæç¤ºï¼Œæ³¨å†Œæ–°ç”¨æˆ·æ˜¯å…¶ä¸­ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨æˆ·é€‰æ‹©æ³¨å†Œæ–°ç”¨æˆ·æ—¶å®¢æˆ·ç«¯æç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œæ³¨å†Œä½¿ç”¨çš„å¯†ç éœ€è¾“å…¥ä¸¤æ¬¡ï¼Œä¸¤æ¬¡ä¸åŒåˆ™éœ€è¦é‡æ–°è¾“å…¥ï¼›å®¢æˆ·ç«¯æ”¶é›†åˆ°åˆæ³•çš„ç”¨æˆ·åå’Œå¯†ç åå°†å…¶å‘é€è‡³æœåŠ¡ç«¯ï¼›æœåŠ¡ç«¯ç”¨æˆ·æ³¨å†Œä¿¡æ¯å­˜å‚¨åˆ°mysqlæ•°æ®åº“ã€‚</p>

<p>åˆ›å»ºä¸€ä¸ªå‡½æ•°é›†ä¸­å¤„ç†ç”¨æˆ·åœ¨å®¢æˆ·ç«¯çš„æ“ä½œ(handleClient)ï¼Œå½“å®¢æˆ·ç«¯å¯åŠ¨å¹¶ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥åï¼Œè°ƒç”¨æ­¤å‡½æ•°ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. å¾ªç¯æ‰“å°æç¤ºä¿¡æ¯ï¼›
2. æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼›
3. å¯¹ç”¨æˆ·è¾“å…¥åšå¤„ç†ï¼› æ‰“å°æ³¨å†Œç”¨æˆ·å’Œé€€å‡ºå®¢æˆ·ç«¯çš„æç¤ºï¼›ä½¿ç”¨intå­˜å‚¨ç”¨æˆ·çš„è¾“å…¥çš„æ“ä½œé€‰é¡¹ä¾¿äºåˆ¤æ–­ï¼›å½“ç”¨æˆ·é€‰æ‹©æ³¨å†Œæ–°ç”¨æˆ·æ—¶ï¼Œè½¬åˆ°æ³¨å†Œæ–°ç”¨æˆ·çš„å¤„ç†é€»è¾‘ï¼š1. è¦æ±‚è¾“å…¥æ–°çš„ç”¨æˆ·åï¼›2. è¦æ±‚è¾“å…¥å¯†ç å¹¶ç¡®è®¤ï¼Œè‹¥ä¸¤æ¬¡è¾“å…¥ä¸åŒåˆ™é‡æ–°è¾“å…¥ï¼Œå› æ­¤è¯¥æ­¥åœ¨å¾ªç¯ä¸­è¿›è¡Œï¼›3. å°†åˆæ³•çš„ç”¨æˆ·åå’Œå¯†ç å¤„ç†æˆä¾¿äºæœåŠ¡ç«¯è§£æçš„å­—ç¬¦ä¸²ï¼Œå‘é€æ­¤å­—ç¬¦ä¸²åˆ°æœåŠ¡ç«¯ï¼›   
</code></pre></div></div>

<p>å¯åŠ¨å®¢æˆ·ç«¯çš„å‡½æ•°è°ƒç”¨handleClientï¼ŒhandleClientéœ€è¦å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥åº”å°†å®¢æˆ·ç«¯çš„å¥—æ¥å­—æè¿°ç¬¦ä½œä¸ºå‚æ•°ä¼ å…¥ï¼›handleClientå‡½æ•°å‘æœåŠ¡ç«¯å‘é€çš„ç”¨æˆ·åå’Œå¯†ç ä¹‹å‰éƒ½æ·»åŠ è¾…åŠ©ä¿¡æ¯ä¾¿äºè§£æï¼Œä¸”å°†ä¸¤ä¸ªå­—ç¬¦ä¸²åˆå¹¶æˆä¸€ä¸ªå†å‘é€ï¼›
handleClientå…·ä½“å®ç°ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">client</span><span class="o">::</span><span class="n">HandleClient</span><span class="p">(</span><span class="kt">int</span> <span class="n">conn</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">choice</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">,</span><span class="n">pass</span><span class="p">,</span><span class="n">pass1</span><span class="p">;</span>

    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">" ------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|                  |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"| è¯·è¾“å…¥ä½ è¦çš„é€‰é¡¹:|</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|    0:é€€å‡º        |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|    1:ç™»å½•        |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|    2:æ³¨å†Œ        |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|                  |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">" ------------------ </span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>

    <span class="c1">//å¼€å§‹å¤„ç†å„ç§äº‹åŠ¡</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">choice</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="c1">//æ³¨å†Œ</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"æ³¨å†Œçš„ç”¨æˆ·å:"</span><span class="p">;</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">name</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"å¯†ç :"</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">pass</span><span class="p">;</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ç¡®è®¤å¯†ç :"</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">pass1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">pass</span><span class="o">==</span><span class="n">pass1</span><span class="p">)</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">else</span>
                    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">name</span><span class="o">=</span><span class="s">"name:"</span><span class="o">+</span><span class="n">name</span><span class="p">;</span>
            <span class="n">pass</span><span class="o">=</span><span class="s">"pass:"</span><span class="o">+</span><span class="n">pass</span><span class="p">;</span>
            <span class="n">string</span> <span class="n">str</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="n">pass</span><span class="p">;</span>
            <span class="n">send</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">str</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">str</span><span class="p">.</span><span class="n">length</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"æ³¨å†ŒæˆåŠŸï¼</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"</span><span class="se">\n</span><span class="s">ç»§ç»­è¾“å…¥ä½ è¦çš„é€‰é¡¹:"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æœåŠ¡ç«¯åœ¨æ¥å—å®¢æˆ·ç«¯å»ºç«‹è¿æ¥çš„è¯·æ±‚åä¼šå»ºç«‹ä¸€ä¸ªçº¿ç¨‹ä»¥æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯å¯èƒ½æ˜¯å¤šç§å¤šæ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ ä¸€ä¸ªå‡½æ•°ä¸“é—¨å¤„ç†è¿™äº›æ¶ˆæ¯ï¼Œå‘½åä¸ºhandleRequestsï¼›</p>

<p>handleRequestséœ€è¦å¯¹æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯çš„ç±»å‹åšå‡ºåˆ¤æ–­ï¼Œå¯¹äºæ¥è‡ªå®¢æˆ·ç«¯çš„ç”¨æˆ·æ³¨å†Œä¿¡æ¯å¯ä»¥ç›´æ¥åˆ¤æ–­å…¶ä¸­æ˜¯å¦åŒ…å«â€œnameï¼šâ€œï¼Œè‹¥åŒ…å«åˆ™è½¬åˆ°å­˜å‚¨æ³¨å†Œæ–°ç”¨æˆ·çš„é€»è¾‘ï¼š</p>
<ol>
  <li>è¿æ¥æ•°æ®åº“ï¼›</li>
  <li>è§£æå®¢æˆ·ç«¯æ¶ˆæ¯ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ï¼›</li>
  <li>å°†ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨åˆ°æ•°æ®åº“ï¼›</li>
</ol>

<p>åˆ¤æ–­å‘é€çš„æ¶ˆæ¯æ˜¯å¦åŒ…å«â€œnameï¼šâ€œï¼Œ å¯ä»¥ä½¿ç”¨å‡½æ•°<code class="language-plaintext highlighter-rouge">std::string::size_t find (const string&amp; str, size_t pos = 0) const noexcept;</code>ï¼Œå…¶æ¥æ”¶ç›®æ ‡å­ä¸²strå’Œæœç´¢èµ·å§‹åœ°å€ï¼Œè¿”å›é¦–æ¬¡åŒ¹é…å­ä¸²çš„ç¬¬ä¸€ä¸ªå­—æ¯çš„ä½ç½®ï¼Œæ— åŒ¹é…ç»“æœè¿”å›<code class="language-plaintext highlighter-rouge">string::npos</code>ï¼›c++è¿æ¥æ•°æ®åº“å‚è€ƒ<a href="/C++è¿æ¥mysql">C++è¿æ¥mysql</a>ï¼›ä¸ºæˆªå–æ¶ˆæ¯ä¸­çš„ç”¨æˆ·åå’Œå¯†ç å¯ä»¥å…ˆä½¿ç”¨å‡½æ•°<code class="language-plaintext highlighter-rouge">string::find</code>æ‰¾åˆ°â€œnameï¼šâ€ï¼Œâ€œpassï¼šâ€çš„èµ·å§‹ä½ç½®ï¼Œå†æŒ‰ä½ç½®å’Œé•¿åº¦å–ç”¨æˆ·åå’Œå¯†ç å­ä¸²ï¼Œå–å­ä¸²ä½¿ç”¨å‡½æ•°<code class="language-plaintext highlighter-rouge">string::string substr (size_t pos = 0, size_t len = npos) const;</code></p>

<p>handleRequestså…·ä½“å®ç°ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">server</span><span class="o">::</span><span class="n">HandleRequest</span><span class="p">(</span><span class="n">string</span> <span class="n">str</span><span class="p">){</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">,</span><span class="n">pass</span><span class="p">;</span>

    <span class="c1">//è¿æ¥MYSQLæ•°æ®åº“</span>
    <span class="n">MYSQL</span> <span class="o">*</span><span class="n">con</span><span class="o">=</span><span class="n">mysql_init</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">mysql_real_connect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="s">"127.0.0.1"</span><span class="p">,</span><span class="s">"root"</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">"ChatProject"</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">CLIENT_MULTI_STATEMENTS</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"name:"</span><span class="p">)</span><span class="o">!=</span><span class="n">str</span><span class="p">.</span><span class="n">npos</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">p1</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"name:"</span><span class="p">),</span><span class="n">p2</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"pass:"</span><span class="p">);</span>
        <span class="n">name</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">p1</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">p2</span><span class="o">-</span><span class="mi">5</span><span class="p">);</span>
        <span class="n">pass</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">p2</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">str</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">-</span><span class="n">p2</span><span class="o">-</span><span class="mi">4</span><span class="p">);</span>
        <span class="n">string</span> <span class="n">search</span><span class="o">=</span><span class="s">"INSERT INTO USER VALUES (</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="n">name</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="s">"</span><span class="se">\"</span><span class="s">,</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="n">pass</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="s">"</span><span class="se">\"</span><span class="s">);"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"sqlè¯­å¥:"</span><span class="o">&lt;&lt;</span><span class="n">search</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">mysql_query</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="n">search</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä¸‹ä¸€ç¯‡ï¼š<a href="/myblogs/ç”¨æˆ·ç™»å½•(c++,-mysql)">ç”¨æˆ·ç™»å½•(c++, mysql)</a></p>

:ET