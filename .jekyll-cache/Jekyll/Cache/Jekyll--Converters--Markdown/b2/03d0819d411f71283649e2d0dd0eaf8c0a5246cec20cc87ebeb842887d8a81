I"n<hr />

<p>æ¥ä¸Šç¯‡ï¼š<a href="/æ³¨å†Œç”¨æˆ·(c++,-mysql)">æ³¨å†Œç”¨æˆ·(c++, mysql)</a>ã€‚å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œå®¢æˆ·ç«¯è´Ÿè´£æ”¶é›†ç”¨æˆ·ç™»å½•ä¿¡æ¯å¹¶å‘é€è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸å…¶åœ¨mysqlæ•°æ®åº“ä¸­å­˜å‚¨çš„ä¿¡æ¯æ ¸å¯¹ï¼Œæ ¸å¯¹åé€šçŸ¥å®¢æˆ·ç«¯è¯¥ç”¨æˆ·å¯å¦ç™»å½•ï¼Œå®¢æˆ·ç«¯è¿›ä¸€æ­¥å¤„ç†ã€‚</p>

<p>å®ç°å®¢æˆ·ç«¯çš„ä»»åŠ¡æ¯”è¾ƒç®€å•ï¼Œå®¢æˆ·ç«¯å¯åŠ¨åä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼Œæç¤ºç”¨æˆ·é€‰æ‹©ä½•ç§æ“ä½œï¼Œè‹¥ç”¨æˆ·é€‰æ‹©ç™»å½•ï¼Œåˆ™è¿›å…¥è´Ÿè´£æ”¶é›†å¹¶å‘é€ç™»å½•ä¿¡æ¯å’Œæ¥æ”¶æœåŠ¡ç«¯åº”ç­”çš„é€»è¾‘ï¼Œè‹¥æœåŠ¡ç«¯æ ¸å¯¹ç”¨æˆ·ä¿¡æ¯æ— è¯¯åˆ™æç¤ºç”¨æˆ·ç™»å½•æˆåŠŸï¼Œå¹¶è®©ç”¨æˆ·é€‰æ‹©åç»­æ“ä½œï¼›</p>

<p>å…·ä½“å®ç°ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">client</span><span class="o">::</span><span class="n">HandleClient</span><span class="p">(</span><span class="kt">int</span> <span class="n">conn</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">choice</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">,</span><span class="n">pass</span><span class="p">,</span><span class="n">pass1</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">if_login</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="c1">//è®°å½•æ˜¯å¦ç™»å½•æˆåŠŸ</span>
    <span class="n">string</span> <span class="n">login_name</span><span class="p">;</span><span class="c1">//è®°å½•æˆåŠŸç™»å½•çš„ç”¨æˆ·å</span>

    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">" ------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|                  |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"| è¯·è¾“å…¥ä½ è¦çš„é€‰é¡¹:|</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|    0:é€€å‡º        |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|    1:ç™»å½•        |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|    2:æ³¨å†Œ        |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|                  |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">" ------------------ </span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>

    <span class="c1">//å¼€å§‹å¤„ç†æ³¨å†Œã€ç™»å½•äº‹ä»¶</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">if_login</span><span class="p">)</span>
           <span class="k">break</span><span class="p">;</span>
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">choice</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="c1">//æ³¨å†Œ</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"æ³¨å†Œçš„ç”¨æˆ·å:"</span><span class="p">;</span>
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">name</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"å¯†ç :"</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">pass</span><span class="p">;</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ç¡®è®¤å¯†ç :"</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">pass1</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">pass</span><span class="o">==</span><span class="n">pass1</span><span class="p">)</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">else</span>
                    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´!</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">name</span><span class="o">=</span><span class="s">"name:"</span><span class="o">+</span><span class="n">name</span><span class="p">;</span>
            <span class="n">pass</span><span class="o">=</span><span class="s">"pass:"</span><span class="o">+</span><span class="n">pass</span><span class="p">;</span>
            <span class="n">string</span> <span class="n">str</span><span class="o">=</span><span class="n">name</span><span class="o">+</span><span class="n">pass</span><span class="p">;</span>
            <span class="n">send</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">str</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">str</span><span class="p">.</span><span class="n">length</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"æ³¨å†ŒæˆåŠŸï¼</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"</span><span class="se">\n</span><span class="s">ç»§ç»­è¾“å…¥ä½ è¦çš„é€‰é¡¹:"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//ç™»å½•</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">choice</span><span class="o">==</span><span class="mi">1</span><span class="o">&amp;&amp;!</span><span class="n">if_login</span><span class="p">){</span>
            <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ç”¨æˆ·å:"</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">name</span><span class="p">;</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"å¯†ç :"</span><span class="p">;</span>
                <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">pass</span><span class="p">;</span>
                <span class="c1">//æ ¼å¼åŒ–</span>
                <span class="n">string</span> <span class="n">str</span><span class="o">=</span><span class="s">"login"</span><span class="o">+</span><span class="n">name</span><span class="p">;</span>
                <span class="n">str</span><span class="o">+=</span><span class="s">"pass:"</span><span class="p">;</span>
                <span class="n">str</span><span class="o">+=</span><span class="n">pass</span><span class="p">;</span>
                <span class="n">send</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="n">str</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">str</span><span class="p">.</span><span class="n">length</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span><span class="c1">//å‘é€ç™»å½•ä¿¡æ¯</span>
                <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
                <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
                <span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="n">buffer</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span><span class="c1">//æ¥æ”¶å“åº”</span>
                <span class="n">string</span> <span class="n">recv_str</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
                <span class="c1">//ç™»å½•æˆåŠŸ</span>
                <span class="k">if</span><span class="p">(</span><span class="n">recv_str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="s">"ok"</span><span class="p">){</span>
                    <span class="n">if_login</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span>
                    <span class="n">login_name</span><span class="o">=</span><span class="n">name</span><span class="p">;</span>
                    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ç™»å½•æˆåŠŸ</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="c1">//ç™»å½•å¤±è´¥</span>
                <span class="k">else</span>
                    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"å¯†ç æˆ–ç”¨æˆ·åé”™è¯¯ï¼</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//ç™»å½•æˆåŠŸ</span>
    <span class="k">if</span><span class="p">(</span><span class="n">if_login</span><span class="p">){</span>
        <span class="n">system</span><span class="p">(</span><span class="s">"clear"</span><span class="p">);</span><span class="c1">//æ¸…ç©ºç»ˆç«¯d</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"        æ¬¢è¿å›æ¥,"</span><span class="o">&lt;&lt;</span><span class="n">login_name</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">" -------------------------------------------</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|                                           |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|          è¯·é€‰æ‹©ä½ è¦çš„é€‰é¡¹ï¼š               |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|              0:é€€å‡º                       |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|              1:å‘èµ·å•ç‹¬èŠå¤©               |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|              2:å‘èµ·ç¾¤èŠ                   |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"|                                           |</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">" ------------------------------------------- </span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥ååˆ›å»ºçº¿ç¨‹æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œåˆ›å»ºå‡½æ•°handleRequestsé›†ä¸­å¤„ç†è¿™äº›è¯·æ±‚ï¼ŒhandleRequestsé¦–å…ˆè¦åˆ¤æ–­æ˜¯ä½•ç§è¯·æ±‚ï¼Œç„¶åé’ˆå¯¹ç‰¹å®šè¯·æ±‚åšç›¸åº”å¤„ç†ï¼Œæœ€ååº”ç­”å®¢æˆ·ç«¯ï¼›<br />
æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¯ä»¥ä½œä¸ºå‚æ•°ä¼ å…¥handleRequestså‡½æ•°ï¼Œä¾‹å¤–æ­¤å‡½æ•°éœ€è¦åº”ç­”å®¢æˆ·ç«¯æ‰€ä»¥è¿˜è¦å°†å®¢æˆ·ç«¯çš„å¥—æ¥å­—æè¿°ç¬¦ä½œä¸ºå‚æ•°ä¼ å…¥ï¼›<br />
å¯¹äºå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¯ä»¥ç”¨å­ä¸²åŒ¹é…çš„å‡½æ•°ç¡®å®šæ˜¯å“ªç§è¯·æ±‚ï¼Œä¹‹åä½¿ç”¨æå–å­ä¸²çš„å‡½æ•°è§£æè¯·æ±‚ï¼Œå¯¹äºç™»å½•è¯·æ±‚è€Œè¨€ï¼Œéœ€è¦å°†è§£æå¾—åˆ°çš„ç™»å½•ä¿¡æ¯å³ç”¨æˆ·åå’Œå¯†ç ä¿å­˜èµ·æ¥ä»¥å’Œæ•°æ®åº“ä¸­å­˜æ”¾çš„ä¿¡æ¯æ ¸å¯¹ï¼Œå¦‚æœä¿¡æ¯æ— è¯¯åˆ™ä¼ å›â€œokâ€œï¼Œå¦åˆ™â€wrongâ€œï¼›
å¯¹äºä¿¡æ¯çš„æ ¸å¯¹å·¥ä½œï¼š</p>
<ol>
  <li>å…ˆå»ºç«‹ä¸mysqlæ•°æ®åº“çš„è¿æ¥ï¼›<a href="/C++è¿æ¥mysql">C++è¿æ¥mysql</a></li>
  <li>æ„é€ sqlæŸ¥è¯¢è¯­å¥æŸ¥è¯¢æ•°æ®åº“ä¸­ç”¨æˆ·åä¸ç™»å½•ä¿¡æ¯ç›¸ç¬¦çš„è®°å½•ï¼› <br />
==&gt; <code class="language-plaintext highlighter-rouge">int mysql_query(MYSQL *mysql, const char *query)</code></li>
  <li>å­˜å‚¨æŸ¥è¯¢å¾—åˆ°çš„ç»“æœé›†ï¼›<br />
==&gt; <code class="language-plaintext highlighter-rouge">MYSQL_RES *mysql_store_result(MYSQL *mysql)</code></li>
  <li>è·å–ç»“æœé›†ä¸­çš„è¡Œæ•°ï¼Œç¡®ä¿ä¸ä»…æŸ¥è¯¢æˆåŠŸä¸”å¾—åˆ°çš„ä¸æ˜¯ç©ºç»“æœé›†ï¼›<br />
==&gt; <code class="language-plaintext highlighter-rouge">my_ulonglong mysql_num_rows(MYSQL_RES *result)</code></li>
  <li>å¦‚æœå¾—åˆ°çš„æ˜¯ç©ºç»“æœé›†åˆ™ç™»å½•ä¿¡æ¯é”™è¯¯ï¼Œåˆ¤æ–­ç»“æŸï¼›</li>
  <li>è·å–ç»“æœé›†çš„ä¸‹ä¸€è¡Œï¼›<br />
==&gt; <code class="language-plaintext highlighter-rouge">MYSQL_ROW mysql_fetch_row(MYSQL_RES *result)</code></li>
  <li>è·å–è¯¥è¡Œç”¨æˆ·åå­—æ®µå’Œå¯†ç å­—æ®µçš„å€¼ï¼›</li>
  <li>è‹¥å¯†ç ä¸ç™»å½•ä¿¡æ¯çš„å¯†ç ç›¸åŒåˆ™ç™»å½•ä¿¡æ¯æ— è¯¯ï¼›</li>
</ol>

<p>å…·ä½“å®ç°ï¼š</p>
<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">server</span><span class="o">::</span><span class="n">HandleRequest</span><span class="p">(</span><span class="kt">int</span> <span class="n">conn</span><span class="p">,</span><span class="n">string</span> <span class="n">str</span><span class="p">){</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">,</span><span class="n">pass</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">if_login</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span><span class="c1">//è®°å½•å½“å‰æœåŠ¡å¯¹è±¡æ˜¯å¦æˆåŠŸç™»å½•</span>
    <span class="n">string</span> <span class="n">login_name</span><span class="p">;</span><span class="c1">//è®°å½•å½“å‰æœåŠ¡å¯¹è±¡çš„åå­—</span>
    <span class="c1">//string target_name;//è®°å½•å‘é€ä¿¡æ¯æ—¶ç›®æ ‡ç”¨æˆ·çš„åå­—</span>
    <span class="c1">//int group_num;//è®°å½•ç¾¤å·</span>


    <span class="c1">//è¿æ¥MYSQLæ•°æ®åº“</span>
    <span class="n">MYSQL</span> <span class="o">*</span><span class="n">con</span><span class="o">=</span><span class="n">mysql_init</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">mysql_real_connect</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="s">"127.0.0.1"</span><span class="p">,</span><span class="s">"root"</span><span class="p">,</span><span class="s">""</span><span class="p">,</span><span class="s">"ChatProject"</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">CLIENT_MULTI_STATEMENTS</span><span class="p">);</span>

    <span class="c1">//æ³¨å†Œ</span>
    <span class="k">if</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"name:"</span><span class="p">)</span><span class="o">!=</span><span class="n">str</span><span class="p">.</span><span class="n">npos</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">p1</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"name:"</span><span class="p">),</span><span class="n">p2</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"pass:"</span><span class="p">);</span>
        <span class="n">name</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">p1</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">p2</span><span class="o">-</span><span class="mi">5</span><span class="p">);</span>
        <span class="n">pass</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">p2</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">str</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">-</span><span class="n">p2</span><span class="o">-</span><span class="mi">4</span><span class="p">);</span>
        <span class="n">string</span> <span class="n">search</span><span class="o">=</span><span class="s">"INSERT INTO USER VALUES (</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="n">name</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="s">"</span><span class="se">\"</span><span class="s">,</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="n">pass</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="s">"</span><span class="se">\"</span><span class="s">);"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"sqlè¯­å¥:"</span><span class="o">&lt;&lt;</span><span class="n">search</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">mysql_query</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="n">search</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="c1">//ç™»å½•</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"login"</span><span class="p">)</span><span class="o">!=</span><span class="n">str</span><span class="p">.</span><span class="n">npos</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">p1</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"login"</span><span class="p">),</span><span class="n">p2</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"pass:"</span><span class="p">);</span>
        <span class="n">name</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">p1</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">p2</span><span class="o">-</span><span class="mi">5</span><span class="p">);</span>
        <span class="n">pass</span><span class="o">=</span><span class="n">str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">p2</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">str</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">-</span><span class="n">p2</span><span class="o">-</span><span class="mi">4</span><span class="p">);</span>
        <span class="n">string</span> <span class="n">search</span><span class="o">=</span><span class="s">"SELECT * FROM USER WHERE NAME=</span><span class="se">\"</span><span class="s">"</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="n">name</span><span class="p">;</span>
        <span class="n">search</span><span class="o">+=</span><span class="s">"</span><span class="se">\"</span><span class="s">;"</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"sqlè¯­å¥:"</span><span class="o">&lt;&lt;</span><span class="n">search</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">auto</span> <span class="n">search_res</span><span class="o">=</span><span class="n">mysql_query</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="n">search</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="k">auto</span> <span class="n">result</span><span class="o">=</span><span class="n">mysql_store_result</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">col</span><span class="o">=</span><span class="n">mysql_num_fields</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="c1">//è·å–åˆ—æ•°</span>
        <span class="kt">int</span> <span class="n">row</span><span class="o">=</span><span class="n">mysql_num_rows</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="c1">//è·å–è¡Œæ•°</span>
        <span class="c1">//æŸ¥è¯¢åˆ°ç”¨æˆ·å</span>
        <span class="k">if</span><span class="p">(</span><span class="n">search_res</span><span class="o">==</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">row</span><span class="o">!=</span><span class="mi">0</span><span class="p">){</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"æŸ¥è¯¢æˆåŠŸ</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
            <span class="k">auto</span> <span class="n">info</span><span class="o">=</span><span class="n">mysql_fetch_row</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="c1">//è·å–ä¸€è¡Œçš„ä¿¡æ¯</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"æŸ¥è¯¢åˆ°ç”¨æˆ·å:"</span><span class="o">&lt;&lt;</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">" å¯†ç :"</span><span class="o">&lt;&lt;</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
            <span class="c1">//å¯†ç æ­£ç¡®</span>
            <span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">pass</span><span class="p">){</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ç™»å½•å¯†ç æ­£ç¡®</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
                <span class="n">string</span> <span class="n">str1</span><span class="o">=</span><span class="s">"ok"</span><span class="p">;</span>
                <span class="n">if_login</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span>
                <span class="n">login_name</span><span class="o">=</span><span class="n">name</span><span class="p">;</span><span class="c1">//è®°å½•ä¸‹å½“å‰ç™»å½•çš„ç”¨æˆ·å</span>
                <span class="n">send</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">str1</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">str1</span><span class="p">.</span><span class="n">length</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">//å¯†ç é”™è¯¯</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"ç™»å½•å¯†ç é”™è¯¯</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
                <span class="kt">char</span> <span class="n">str1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="o">=</span><span class="s">"wrong"</span><span class="p">;</span>
                <span class="n">send</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">str1</span><span class="p">,</span><span class="n">strlen</span><span class="p">(</span><span class="n">str1</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">//æ²¡æ‰¾åˆ°ç”¨æˆ·å</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">"æŸ¥è¯¢å¤±è´¥</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span>
            <span class="kt">char</span> <span class="n">str1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="o">=</span><span class="s">"wrong"</span><span class="p">;</span>
            <span class="n">send</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">str1</span><span class="p">,</span><span class="n">strlen</span><span class="p">(</span><span class="n">str1</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ä¸‹ä¸€ç¯‡ï¼š<a href="/ç§èŠ(äº’æ–¥é”,-map,-tuple)">ç§èŠ(äº’æ–¥é”, map, tuple)</a></p>

:ET